# Как пользоваться

`client.py` это основная библиотека. Её зависимость — `items.py`, нужна для безопасных операций с файлом списка. Единственная зависимость не из стандартной библиотеки: `pexpect` (`telnetlib` из стандартной библиотеки скоро будет deprecated). `pexpect` не реализует telnet самостоятельно, поэтому на системе должен быть установлен пакет, предоставляющий telnet. На Debian это выглядит так:

```
# apt install -y telnet python3-pexpect
```

Чтобы скрипт работал, надо задать через environment или в самих скриптах переменные из `env.example`, а также эти параметры в `openvpn.conf`: 

```
# для telnet-интерфейса, нужен чтобы убить сессию
management 127.0.0.1 11528 

# чтобы скрипт блокировки работал
script-security 2

# путь к скрипту
# скрипт и его лог-файл должны быть запускаемы 
# от пользователя, от которого раннится демон openvpn
tls-verify /opt/openvpn/etc/tls_verify.sh
```

Дальше можно тянуть Python библиотеку и управлять блокировкой через неё:

```python
from client import OpenVPNClient as OVPN

# Здесь CN блокируемого без 'CN=' в начале
foobar = OVPN("foobar")
foobar.block() # убивает сессию, добавляет CN в банлист
foobar.unblock() # разблокирует клиента
```

Учтите, что для успешной блокировки и разблокировки процесс, запускающий библиотеку, должен иметь право **чтения и записи на директорию, где находится файл blocklist**. 

Библиотека идемпотентная, т.е. можно заблокировать уже заблокированного или разблокировать уже разблокированного без ошибок. 
